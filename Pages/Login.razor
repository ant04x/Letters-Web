@page "/login"

<EditForm class="loginScreen" Model="@Creds">

    <label class="addresseTextField mdc-text-field mdc-text-field--outlined">
        <span class="mdc-notched-outline">
            <span class="mdc-notched-outline__leading"></span>
            <span class="mdc-notched-outline__notch">
                <span class="mdc-floating-label" id="my-label-id">Correo</span>
            </span>
            <span class="mdc-notched-outline__trailing"></span>
        </span>
        <!--<input type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">-->
        <InputText id="toEmail" @bind-Value="Creds.UserName" type="email" class="mdc-text-field__input" aria-labelledby="my-label-id" />
    </label>

    <label class="affairTextField mdc-text-field mdc-text-field--outlined">
        <span class="mdc-notched-outline">
            <span class="mdc-notched-outline__leading"></span>
            <span class="mdc-notched-outline__notch">
                <span class="mdc-floating-label" id="my-label-id">Constraseña</span>
            </span>
            <span class="mdc-notched-outline__trailing"></span>
        </span>
        <!--<input type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">-->
        <InputText id="subjectEmail" @bind-Value="Creds.UserPass" type="password" class="mdc-text-field__input" aria-labelledby="my-label-id2" />
    </label>

    <button @onclick="OnEnterClick" class="mdc-button mdc-button--raised">
        <span class="mdc-button__label">Entrar</span>
    </button>

</EditForm>

@inject NavigationManager NavigationManager

@code {

    public static Credentials Creds
    {
        get;
        private set;
    } = new Credentials();

    public static bool IsSuccess
    {
        get;
        private set;
    } = false;

    protected async void OnEnterClick()
    {
        using (var smtp = new MailKit.Net.Smtp.SmtpClient())
        {
            smtp.ServerCertificateValidationCallback = (s, c, h, e) => true;
            Console.WriteLine("NOMBRE DE USUARIO Y PASS: " + Login.Creds.UserName + " " + Login.Creds.UserPass);

            try
            {
                await smtp.ConnectAsync("smtp-mail.outlook.com", 587, MailKit.Security.SecureSocketOptions.StartTls);
                await smtp.AuthenticateAsync(Login.Creds.UserName, Login.Creds.UserPass);
                await smtp.DisconnectAsync(true);
                IsSuccess = true;
            } catch
            {
                IsSuccess = false;
            }
        }
        if (IsSuccess == true)
            NavigationManager.NavigateTo("/");
        else
            Console.WriteLine("WARNING: Login unsuccessfull.");
    }

}