@page "/login"

<div class="loginContainer">
    <div class="loginCard mdc-card mdc-card--outlined">
        <EditForm class="loginScreen" Model="@Creds">
            <div>
                <i class="loginPersonImage">
                    <svg width="96px" height="96px" viewBox="0 0 42 42" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path d="M 20 3.5 A 16.5 16.5 0 0 0 3.5 20 A 16.5 16.5 0 0 0 20 36.5 A 16.5 16.5 0 0 0 36.5 20 A 16.5 16.5 0 0 0 20 3.5 z M 19.994141 8.4628906 C 23.228455 8.4628906 25.851562 11.08404 25.851562 14.318359 C 25.851562 17.552649 23.228455 20.173828 19.994141 20.173828 C 16.759826 20.173828 14.138672 17.552649 14.138672 14.318359 C 14.138672 11.08404 16.759826 8.4628906 19.994141 8.4628906 z M 13.113281 22.517578 L 26.876953 22.517578 C 28.210715 22.517578 29.298409 23.566033 29.361328 24.884766 L 29.365234 25.005859 L 29.365234 25.445312 C 29.365234 27.644627 28.228673 29.291603 26.484375 30.353516 C 24.769158 31.397744 22.461927 31.886719 19.994141 31.886719 C 17.526357 31.886719 15.221109 31.397744 13.505859 30.353516 C 11.814401 29.323781 10.69526 27.742726 10.628906 25.642578 L 10.625 25.445312 L 10.625 25.005859 C 10.625 23.671481 11.675841 22.582387 12.994141 22.519531 L 13.113281 22.517578 z " id="🎨-Color"></path>
                    </svg>
                </i>
                <label class="addresseTextField mdc-text-field mdc-text-field--outlined">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="my-label-id">Correo</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <!--<input type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">-->
                    <InputText id="toEmail" @bind-Value="Creds.UserName" type="email" class="mdc-text-field__input" aria-labelledby="my-label-id" />
                </label>

                <label class="affairTextField mdc-text-field mdc-text-field--outlined">
                    <span class="mdc-notched-outline">
                        <span class="mdc-notched-outline__leading"></span>
                        <span class="mdc-notched-outline__notch">
                            <span class="mdc-floating-label" id="my-label-id">Constraseña</span>
                        </span>
                        <span class="mdc-notched-outline__trailing"></span>
                    </span>
                    <!--<input type="text" class="mdc-text-field__input" aria-labelledby="my-label-id">-->
                    <InputText id="subjectEmail" @bind-Value="Creds.UserPass" type="password" class="mdc-text-field__input" aria-labelledby="my-label-id2" />
                </label>
            </div>

            <div class="mdc-card__actions">
                <div class="rightLoginActions">
                    <button class="mdc-button">
                        <div class="mdc-button__ripple"></div>
                        <span class="mdc-button__label">Cancelar</span>
                    </button>
                    <button @onclick="OnEnterClick" type="submit" class="mdc-button mdc-button--raised">
                        <div class="mdc-button__ripple"></div>
                        <span class="mdc-button__label">Entrar</span>
                    </button>
                </div>
            </div>

        </EditForm>
    </div>
</div>

@inject NavigationManager NavigationManager

@code {

    public static Credentials Creds
    {
        get;
        private set;
    } = new Credentials();

    public static bool IsSuccess
    {
        get;
        private set;
    } = false;

    protected async void OnEnterClick()
    {
        using (var smtp = new MailKit.Net.Smtp.SmtpClient())
        {
            smtp.ServerCertificateValidationCallback = (s, c, h, e) => true;
            // Console.WriteLine("NOMBRE DE USUARIO Y PASS: " + Login.Creds.UserName + " " + Login.Creds.UserPass);

            try
            {
                await smtp.ConnectAsync("smtp-mail.outlook.com", 587, MailKit.Security.SecureSocketOptions.StartTls);
                await smtp.AuthenticateAsync(Login.Creds.UserName, Login.Creds.UserPass);
                await smtp.DisconnectAsync(true);
                IsSuccess = true;
            } catch
            {
                IsSuccess = false;
            }
        }
        if (IsSuccess == true)
            NavigationManager.NavigateTo("/home");
        else
            Console.WriteLine("WARNING: Login unsuccessfull.");
    }

}